<!DOCTYPE html>
<html>
<head>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, -apple-system, sans-serif;
      font-size: 12px;
      padding: 12px;
      background: #1e1e1e;
      color: #fff;
    }
    h2 { font-size: 14px; margin-bottom: 12px; color: #fff; }
    h3 { font-size: 12px; margin-bottom: 8px; color: #aaa; font-weight: 500; }
    .section { margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #333; }
    .section:last-child { border-bottom: none; }
    button {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 6px;
      margin-bottom: 6px;
      font-size: 11px;
    }
    button:hover { background: #6d28d9; }
    button.secondary {
      background: #333;
      border: 1px solid #444;
    }
    button.secondary:hover { background: #444; }
    button.success {
      background: #059669;
    }
    button.success:hover { background: #047857; }
    button.primary {
      background: #0d99ff;
    }
    button.primary:hover { background: #0b85e0; }
    .desc { color: #888; font-size: 10px; margin-bottom: 8px; }
    .stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 8px 0;
    }
    .stat {
      background: #2d2d2d;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
    }
    .stat-value { font-weight: bold; color: #0d99ff; }
    .stat-warn { color: #f59e0b; }
    .stat-good { color: #10b981; }
    #output {
      background: #2d2d2d;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 8px;
      height: 180px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 10px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .color-preview {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 3px;
      margin-right: 6px;
      vertical-align: middle;
      border: 1px solid #444;
    }
    .proposed-item {
      background: #2d2d2d;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .proposed-name {
      font-weight: 500;
    }
    .proposed-meta {
      color: #888;
      font-size: 10px;
    }
    input[type="text"] {
      background: #2d2d2d;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 4px 8px;
      color: #fff;
      font-size: 11px;
      width: 120px;
    }
    .tab-bar {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
    }
    .tab {
      padding: 8px 16px;
      background: #2d2d2d;
      border: none;
      border-radius: 6px 6px 0 0;
      color: #888;
      cursor: pointer;
      font-size: 11px;
    }
    .tab.active {
      background: #333;
      color: #fff;
    }
    .tab-content {
      display: none;
      background: #333;
      padding: 12px;
      border-radius: 0 6px 6px 6px;
    }
    .tab-content.active {
      display: block;
    }
    .scroll-list {
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>üé® Design System Audit</h2>
  
  <div class="section">
    <h3>üìä Analyze Design</h3>
    <p class="desc">Extract and analyze patterns from your designs</p>
    <button id="analyzeSelection">Analyze Selection</button>
    <button id="analyzePage">Analyze Page</button>
    <button id="analyzeAll">Analyze All</button>
    <div id="analysisStats" class="stats" style="display: none;"></div>
  </div>
  
  <div class="section" id="proposalSection" style="display: none;">
    <h3>‚ú® Proposed Design System</h3>
    
    <div class="tab-bar">
      <button class="tab active" data-tab="colors">Colors</button>
      <button class="tab" data-tab="text">Typography</button>
      <button class="tab" data-tab="spacing">Spacing</button>
    </div>
    
    <div id="colors-tab" class="tab-content active">
      <div id="colorProposals" class="scroll-list"></div>
      <div style="margin-top: 8px;">
        <button class="success" id="createColorStyles">Create Color Styles</button>
      </div>
    </div>
    
    <div id="text-tab" class="tab-content">
      <div id="textProposals" class="scroll-list"></div>
      <div style="margin-top: 8px;">
        <button class="success" id="createTextStyles">Create Text Styles</button>
      </div>
    </div>
    
    <div id="spacing-tab" class="tab-content">
      <div id="spacingProposals"></div>
    </div>
  </div>
  
  <div class="section">
    <h3>üß© Components</h3>
    <p class="desc">Audit components, instances, and usage</p>
    <button id="auditComponentsSelection">Audit Selection</button>
    <button id="auditComponentsPage">Audit Page</button>
    <button id="auditComponentsAll">Audit All</button>
  </div>
  
  <div class="section">
    <h3>üîç Full Audit</h3>
    <p class="desc">Run all audits at once (colors, text, spacing, components)</p>
    <button class="primary" id="fullAuditPage">Full Audit (Page)</button>
    <button class="primary" id="fullAuditAll">Full Audit (All)</button>
  </div>
  
  <div class="section">
    <h3>üìã Existing Styles</h3>
    <button class="secondary" id="viewExisting">View Current Styles</button>
  </div>
  
  <div class="section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
      <span style="color: #888; font-size: 10px;">Output</span>
      <button class="secondary" id="copyOutput" style="padding: 4px 8px; font-size: 10px;">Copy</button>
    </div>
    <div id="output">Ready. Click "Analyze" to scan your designs.</div>
  </div>

  <script>
    const output = document.getElementById('output');
    const analysisStats = document.getElementById('analysisStats');
    const proposalSection = document.getElementById('proposalSection');
    
    let currentAnalysis = null;
    
    function log(data) {
      output.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }
    
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      };
    });
    
    // Analysis buttons
    document.getElementById('analyzeSelection').onclick = () => {
      log('Analyzing selection...');
      parent.postMessage({ pluginMessage: { type: 'full-analysis', scope: 'selection' } }, '*');
    };
    
    document.getElementById('analyzePage').onclick = () => {
      log('Analyzing page...');
      parent.postMessage({ pluginMessage: { type: 'full-analysis', scope: 'page' } }, '*');
    };
    
    document.getElementById('analyzeAll').onclick = () => {
      log('Analyzing entire document...');
      parent.postMessage({ pluginMessage: { type: 'full-analysis', scope: 'document' } }, '*');
    };
    
    document.getElementById('viewExisting').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'get-existing-styles' } }, '*');
    };
    
    // Component audit buttons
    document.getElementById('auditComponentsSelection').onclick = () => {
      log('Auditing components in selection...');
      parent.postMessage({ pluginMessage: { type: 'audit-components', scope: 'selection' } }, '*');
    };
    
    document.getElementById('auditComponentsPage').onclick = () => {
      log('Auditing components on page...');
      parent.postMessage({ pluginMessage: { type: 'audit-components', scope: 'page' } }, '*');
    };
    
    document.getElementById('auditComponentsAll').onclick = () => {
      log('Auditing components in document...');
      parent.postMessage({ pluginMessage: { type: 'audit-components', scope: 'document' } }, '*');
    };
    
    // Full audit buttons
    document.getElementById('fullAuditPage').onclick = () => {
      log('Running full audit on page...');
      parent.postMessage({ pluginMessage: { type: 'complete-audit', scope: 'page' } }, '*');
    };
    
    document.getElementById('fullAuditAll').onclick = () => {
      log('Running full audit on document...');
      parent.postMessage({ pluginMessage: { type: 'complete-audit', scope: 'document' } }, '*');
    };
    
    document.getElementById('copyOutput').onclick = () => {
      const text = output.textContent;
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      const btn = document.getElementById('copyOutput');
      btn.textContent = '‚úì Copied';
      setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
    };
    
    // Create styles buttons
    document.getElementById('createColorStyles').onclick = () => {
      if (!currentAnalysis || !currentAnalysis.colors.proposedPalette) {
        log('No color analysis available. Run analysis first.');
        return;
      }
      
      // Get the names from inputs
      const palette = currentAnalysis.colors.proposedPalette.map((color, i) => {
        const input = document.getElementById('color-name-' + i);
        return {
          ...color,
          name: input ? input.value : color.suggestedName
        };
      });
      
      log('Creating ' + palette.length + ' color styles...');
      parent.postMessage({ pluginMessage: { type: 'create-paint-styles', palette } }, '*');
    };
    
    document.getElementById('createTextStyles').onclick = () => {
      if (!currentAnalysis || !currentAnalysis.text.proposedScale) {
        log('No text analysis available. Run analysis first.');
        return;
      }
      
      log('Creating text styles...');
      parent.postMessage({ pluginMessage: { type: 'create-text-styles', typeScale: currentAnalysis.text.proposedScale } }, '*');
    };
    
    function renderColorProposals(colors) {
      const container = document.getElementById('colorProposals');
      container.innerHTML = colors.proposedPalette.slice(0, 12).map((color, i) => `
        <div class="proposed-item">
          <div>
            <span class="color-preview" style="background: ${color.hex}"></span>
            <input type="text" id="color-name-${i}" value="${color.suggestedName}" />
          </div>
          <div class="proposed-meta">${color.hex} ¬∑ ${color.usage} uses</div>
        </div>
      `).join('');
    }
    
    function renderTextProposals(text) {
      const container = document.getElementById('textProposals');
      container.innerHTML = text.proposedScale.slice(0, 10).map(style => `
        <div class="proposed-item">
          <div>
            <span class="proposed-name">${style.suggestedName}</span>
            <span class="proposed-meta"> ¬∑ ${style.fontFamily} ${style.fontSize}px</span>
          </div>
          <div class="proposed-meta">${style.usage} uses</div>
        </div>
      `).join('');
    }
    
    function renderSpacingProposals(spacing) {
      const container = document.getElementById('spacingProposals');
      container.innerHTML = `
        <div class="stat" style="margin-bottom: 8px;">
          Recommended scale: <span class="stat-value">${spacing.recommendedScale}</span>
          ¬∑ ${spacing.compliance}% compliant
        </div>
        <div style="color: #888; font-size: 10px; margin-bottom: 8px;">
          Scale values: ${spacing.scaleValues.join(', ')}px
        </div>
        ${spacing.offScaleValues.length > 0 ? `
          <div style="color: #f59e0b; font-size: 10px;">
            ‚ö†Ô∏è ${spacing.offScaleValues.length} off-scale values found
          </div>
        ` : '<div style="color: #10b981; font-size: 10px;">‚úì All spacing follows the scale</div>'}
      `;
    }
    
    // Handle messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;
      
      if (msg.type === 'full-analysis-result') {
        currentAnalysis = msg.data;
        
        // Show stats
        analysisStats.style.display = 'flex';
        analysisStats.innerHTML = `
          <div class="stat">Nodes: <span class="stat-value">${msg.data.audit.nodesChecked}</span></div>
          <div class="stat">Colors: <span class="stat-value">${msg.data.colors.totalColors}</span> ‚Üí <span class="stat-good">${msg.data.colors.groupsFound}</span></div>
          <div class="stat">Text: <span class="stat-value">${msg.data.text.totalVariations}</span> ‚Üí <span class="stat-good">${msg.data.text.proposedScale.length}</span></div>
          <div class="stat">Spacing: <span class="stat-value ${msg.data.spacing.compliance < 80 ? 'stat-warn' : 'stat-good'}">${msg.data.spacing.compliance}%</span> compliant</div>
        `;
        
        // Show proposals
        proposalSection.style.display = 'block';
        renderColorProposals(msg.data.colors);
        renderTextProposals(msg.data.text);
        renderSpacingProposals(msg.data.spacing);
        
        log(msg.data);
      }
      
      if (msg.type === 'existing-styles') {
        log(msg.data);
      }
      
      if (msg.type === 'styles-created') {
        log('‚úì Created styles:\n' + msg.data.created.join('\n') + 
            (msg.data.errors.length > 0 ? '\n\nErrors:\n' + msg.data.errors.map(e => e.name + ': ' + e.error).join('\n') : ''));
      }
    };
  </script>
</body>
</html>
